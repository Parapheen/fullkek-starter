package http

import (
    stdhttp "net/http"
    "os"
    "strconv"
    "time"
)

func SessionCookieName() string {
    if v := os.Getenv("SESSION_COOKIE_NAME"); v != "" {
        return v
    }
    return "sid"
}

func SessionTTL() time.Duration {
    if v := os.Getenv("SESSION_TTL_DAYS"); v != "" {
        if days, err := strconv.Atoi(v); err == nil && days > 0 {
            return time.Duration(days) * 24 * time.Hour
        }
    }
    return 30 * 24 * time.Hour
}

func SetCookie(w stdhttp.ResponseWriter, name, value string, expires time.Time) {
    stdhttp.SetCookie(w, &stdhttp.Cookie{
        Name:     name,
        Value:    value,
        Path:     "/",
        HttpOnly: true,
        SameSite: stdhttp.SameSiteLaxMode,
        Expires:  expires,
        Secure:   false,
    })
}

func ClearCookie(w stdhttp.ResponseWriter, name string) {
    stdhttp.SetCookie(w, &stdhttp.Cookie{
        Name:     name,
        Value:    "",
        Path:     "/",
        HttpOnly: true,
        SameSite: stdhttp.SameSiteLaxMode,
        Expires:  time.Unix(0, 0),
        MaxAge:   -1,
    })
}

func ReadCookie(req *stdhttp.Request, name string) string {
    c, err := req.Cookie(name)
    if err != nil {
        return ""
    }
    return c.Value
}
